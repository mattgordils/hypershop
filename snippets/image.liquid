{%-liquid
	assign max_width = 2000

	if max_size != blank
		assign max_width = max_size
	endif

	if layout != blank
		assign object_fit = 'object-' | append: layout
	endif

	assign image_sizes = sizes | default: '100vw'
	
	assign alt_text = ''
	if alt
		assign alt_text = alt | strip_html
	endif

	assign image_loading = loading | default: 'lazy'

	assign image_width = src.width
	if width
		assign image_width = width
	endif

	assign image_height = src.height
	if height
		assign image_height = height
	endif

	assign image_class = class
	if image_loading == 'lazy'
		assign image_class = image_class | append: ' opacity-0 transition-opacity duration-slow'
	endif

	if layout == 'cover' or layout == 'contain'
		assign image_class = image_class | append: ' ' | append: object_fit | append: ' absolute top-0 left-0 w-full h-full'
	endif
-%}

<script>
	function revealImage(event) {
		event.target.classList.remove('opacity-0')
	}
</script>

{% if image != blank %}
	<img 
		class="{{ image_class }}"
		id="{{ id }}"
		src="{{ image | asset_img_url: '480x' | split: '?' | first }}"
		width="{{ image_width }}"
		height="{{ image_height }}"
		sizes="{{ image_sizes }}"
		srcset="{{ image | asset_img_url: '640x' | split: '?' | first }} 640w,
						{{ image | asset_img_url: '720x' | split: '?' | first }} 720w,
						{{ image | asset_img_url: '900x' | split: '?' | first }} 900w,
						{{ image | asset_img_url: '1200x' | split: '?' | first }} 1200w,
						{{ image | asset_img_url: '1500x' | split: '?' | first }} 1500w,
						{{ image | asset_img_url: '1800x' | split: '?' | first }} 1800w,
						{{ image | asset_img_url: '2000x' | split: '?' | first }} 2000w,
						{{ image | asset_img_url: '2400x' | split: '?' | first }} 2400w"
		loading="{{ image_loading }}"
		alt="{{ alt_text }}"
		
		onLoad="revealImage(event)"
		
	>
{% else %}
	<img 
		class="{{ image_class }}"
		id="{{ id }}"
		src="{{ src | image_url: width: '480x' }}"
		width="{{ image_width }}"
		height="{{ image_height }}"
		sizes="{{ image_sizes }}"
		srcset="{% if src.width > 640 and max_width >= 640 %}{{ src.src | img_url: '640x' }} 640w,{% endif %}
						{% if src.width > 720 and max_width >= 720 %},{{ src.src | img_url: '720x' }} 720w,{% endif %}
						{% if src.width > 900 and max_width >= 900 %},{{ src.src | img_url: '900x' }} 900w,{% endif %}
						{% if src.width > 1200 and max_width >= 1200 %},{{ src.src | img_url: '1200x' }} 1200w,{% endif %}
						{% if src.width > 1500 and max_width >= 1500 %},{{ src.src | img_url: '1500x' }} 1500w,{% endif %}
						{% if src.width > 1800 and max_width >= 1800 %},{{ src.src | img_url: '1800x' }} 1800w,{% endif %}
						{% if src.width > 2000 and max_width >= 2000 %},{{ src.src | img_url: '2000x' }} 2000w,{% endif %}
						{% if src.width > 2400 and max_width >= 2400 %},{{ src.src | img_url: '2400x' }} 2400w,{% endif %}"
		loading="{{ image_loading }}"
		alt="{{ alt_text }}"
		
		onLoad="revealImage(event)"
		
	>
{% endif %}