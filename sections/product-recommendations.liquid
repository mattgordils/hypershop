<script src="{{ 'product-recommendations.js' | asset_url }}" defer></script>

{% capture spacing_class %}
  {% render 'util-section-spacing' with space: section.settings.section_spacing %}
{% endcapture %}

<div class="px-margin overflow-hidden {{ spacing_class }}">
  <product-recommendations
    class="product-recommendations"
    data-product-handle="{{ product.handle }}"
    data-product-id="{{ product.id }}"
    {% if product.collections.size > 0 %}
    data-collection-handle="{{ product.collections.first.handle }}"
    {% endif %}
    data-product-tags="{{ product.tags | join: ',' }}"
    data-min-products="{{ section.settings.min_products }}"
    data-max-products="{{ section.settings.max_products }}"
    data-hide-sold-out="{{ section.settings.hide_sold_out }}"
    data-section-id="{{ section.id }}"
  >
    {%- if section.settings.heading != blank -%}
      <h2 class="h3 mb-v-space-sm">{{ section.settings.heading }}</h2>
    {%- endif -%}

    <div data-loading class="text-center py-8">
      <p>Loading recommendations...</p>
    </div>

    <div data-product-container class="grid grid-cols-2 lg:grid-cols-4 gap-x-gutter gap-y-v-space"></div>
  </product-recommendations>
</div>

{% schema %}
{
  "name": "Product Recommendations",
  "tag": "section",
  "class": "section-product-recommendations",
  "settings": [
    {
      "type": "paragraph",
      "content": "Displays product recommendations with intelligent fallbacks. First tries Shopify's recommendation API, then products from the same collection, then products with the same tags, and finally random products to meet the minimum."
    },
    {
      "type": "text",
      "id": "heading",
      "default": "You may also like",
      "label": "Heading"
    },
    {
      "type": "range",
      "id": "min_products",
      "min": 1,
      "max": 12,
      "step": 1,
      "default": 4,
      "label": "Minimum products to show",
      "info": "If fewer recommendations are available, the section will fill with products from the same collection, tags, or random products"
    },
    {
      "type": "range",
      "id": "max_products",
      "min": 1,
      "max": 12,
      "step": 1,
      "default": 8,
      "label": "Maximum products to show"
    },
    {
      "type": "checkbox",
      "id": "hide_sold_out",
      "default": true,
      "label": "Hide sold out products",
      "info": "When enabled, sold out products will be excluded and replaced with other available products to meet the minimum"
    },
    {
      "type": "select",
      "id": "section_spacing",
      "default": "medium",
      "label": "Section Spacing",
      "info": "This can be used to adjust or remove the space below this section",
      "options": [
        {
          "label": "None",
          "value": "none"
        },
        {
          "label": "Small",
          "value": "small"
        },
        {
          "label": "Medium",
          "value": "medium"
        },
        {
          "label": "Large",
          "value": "large"
        }
      ]
    }
  ]
}
{% endschema %}
