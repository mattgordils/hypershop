{{ 'slider.css' | asset_url | stylesheet_tag }}
<script src="{{ 'slider.bundle.js' | asset_url }}" defer="defer"></script>

{% style %}
  variant-radios input ~ label {
    border-color: transparent;
  }

  variant-radios input:checked ~ label {
    border-color: currentcolor;
  }
{% endstyle %}

{%-liquid
  assign section_product = product
  assign section_height_class = 'lg:aspect-auto lg:h-screen'
  assign on_pdp = true
  assign show_dynamic_checkout = true
  assign product_form_id = 'product-form-' | append: section.id
  if product == blank
    assign on_pdp = false
    assign section_product = section.settings.product
    assign section_height_class = 'lg:aspect-square lg:max-h-screen'
  endif
-%}
<div class="{{ section.settings.section_margin }}">
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-y-margin items-center">
    <div class="col-span-1 relative">
      <div>
        <slider-component
          id="Slider-main"
          class="keen-slider no-dots loop arrows-full aspect-3/4 {{ section_height_class }}"
        >
          {% for product_image in section_product.images %}
            <div class="keen-slider__slide bg-light-grey h-full">
              {%- if product_image != blank -%}
                <img
                  srcset="{{ product_image | image_url: width: 165 }} 165w,
                    {{ product_image | image_url: width: 360 }} 360w,
                    {{ product_image | image_url: width: 533 }} 533w,
                    {{ product_image | image_url: width: 720 }} 720w,
                    {{ product_image | image_url: width: 940 }} 940w,
                    {{ product_image | image_url: width: 1066 }} 1066w,
                    {{ product_image | image_url: width: 1200 }} 1200w"
                  src="{{ product_image | image_url: width: 533 }}"
                  sizes="(min-width: 1024px) calc(100vw / 1.8), 100vw"
                  alt="{{ product_image.alt | escape }}"
                  class="transition-all duration-md absolute top-0 left-0 w-full h-full object-cover{% if hover_image != blank %} z-1{% endif %}"
                  {% unless lazy_load == false %}loading="lazy"{% endunless %}
                  width="{{ product_image.width }}"
                  height="{{ product_image.height }}"
                  loading="eager"
                >
              {%- else -%}
                {% render 'placeholder-img' with icon: 'img-lg' %}
              {%- endif -%}
            </div>
          {% endfor %}
        </slider-component>
      </div>
      <div class="absolute bottom-margin left-margin right-margin lg:bottom-gutter lg:left-gutter lg:right-gutter flex justify-center">
        <slider-component
          class="keen-slider max-w-[500px]"
          data-thumbnails="Slider-main"
          data-slider-settings='{
            "spacing": 10
          }'
        >
          {% for product_image in section_product.images %}
            <div class="keen-slider__slide h-full">
              {%- if product_image != blank -%}
                <img
                  srcset="{{ product_image | image_url: width: 165 }} 165w,
                    {{ product_image | image_url: width: 360, height: 360 }} 360w,
                    {{ product_image | image_url: width: 500, height: 500 }} 500w"
                  src="{{ product_image | image_url: width: 533 }}"
                  sizes="(min-width: 990px) 500px, 300px"
                  alt="{{ product_image.alt | escape }}"
                  class="transition-all duration-md"
                  {% unless lazy_load == false %}loading="lazy"{% endunless %}
                  width="{{ product_image.width }}"
                  height="{{ product_image.height }}"
                  loading="eager"
                >
              {%- else -%}
                {% render 'placeholder-img' with icon: 'img-lg' %}
              {%- endif -%}
            </div>
          {% endfor %}
        </slider-component>
      </div>
    </div>

    <div class="col-span-1">
      <div class="px-margin max-w-[800px] mx-auto {% if on_pdp %} lg:mt-header{% endif %}">
        <div>
          <h1 class="mb-4 h2">{{ section_product.title }}</h1>
          <div class="body-small rich-text">
            <p>{{ section_product.description }}</p>
          </div>
          
          <product-form class="product-form">
            <variant-radios class="pdp-swatches" data-section="{{ section.id }}" data-url="{{ product.url }}" {{ block.shopify_attributes }}>
              {%- for option in product.options_with_values -%}
                <fieldset class="flex product-form__input items-center{% if option.name != 'Color' %} flex-col gap-y-3{% endif %}">
                  <div class="grow text-left">
                    <legend class="form__label h6 text-light-text-color">{{ option.name }}: <span id="selectedOption"></span></legend>
                  </div>
                  <div class="flex {% if option.name != 'Color' %}flex-wrap gap-2 justify-center{% else %}gap-x-[10px]{% endif %}">
                    {%- for value in option.values -%}
                      {% assign color = value | downcase %}
                      <div>
                        <input
                          type="radio" 
                          class="hidden"
                          id="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}"
                          name="{{ option.name }}"
                          value="{{ value | escape }}"
                          form="{{ product_form_id }}"
                          {% if option.selected_value == value %}checked{% endif %}
                        >
                        {%- if option.name == 'Color' -%}
                          <label
                            for="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}"
                            class="border swatch w-[20px] h-[20px] block rounded-full"
                            style="color: {{ value }}"
                            title="{{ value }}"
                          >
                            <div class="swatch w-[14px] h-[14px] m-[2px] block rounded full bg-current"></div>
                          </label>
                        {% else %}
                          <label
                            for="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}"
                            class="border h6 whitespace-nowrap rounded-full inline-flex items-center justify-center h-[31px] px-3 transition-all duration-md cursor-pointer bubble-label"
                            title="{{ value }}"
                          >
                            {{ value }}
                          </label>
                        {% endif %}
                      </div>
                    {%- endfor -%}
                  </div>
                </fieldset>
              {%- endfor -%}
              <script type="application/json">
                {{ product.variants | json }}
              </script>
            </variant-radios>

            {%- form 'product', section_product, id: product_form_id, class: 'form', novalidate: 'novalidate', data-type: 'add-to-cart-form' -%}
              <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" disabled>
              <div class="product-form__buttons grid gap-y-gutter">
                <button
                  type="submit"
                  name="add"
                  class="button w-full {% if show_dynamic_checkout and section_product.selling_plan_groups == empty %}button--secondary{% else %}button--primary{% endif %}"
                  {% if section_product.selected_or_first_available_variant.available == false %}disabled{% endif %}
                >
                  <span>
                    {%- if section_product.selected_or_first_available_variant.available -%}
                      {{ 'products.product.add_to_cart' | t }}
                    {%- else -%}
                      {{ 'products.product.sold_out' | t }}
                    {%- endif -%}
                  </span>
                  <div class="loading-overlay__spinner hidden">
                    <svg aria-hidden="true" focusable="false" role="presentation" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
                      <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                    </svg>
                  </div>
                </button>
                {%- if show_dynamic_checkout -%}
                  {{ form | payment_button }}
                {%- endif -%}
              </div>
            {%- endform -%}
          </product-form>

        </div>
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Product Details",
  "tag": "section",
  "class": "section product-details",
  "settings": [
    {
      "type": "product",
      "id": "product",
      "label": "Product"
    },
    {
      "type": "select",
      "id": "section_margin",
      "default": "mb-v-spacing",
      "label": "Section Margin",
      "info": "This can be used to adjust or remove the space below this section",
      "options": [
        {
          "label": "none",
          "value": "mb-0"
        },
        {
          "label": "Small",
          "value": "mb-v-spacing-sm"
        },
        {
          "label": "Medium",
          "value": "mb-v-spacing"
        },
        {
          "label": "Large",
          "value": "mb-v-spacing-lg"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Product Details"
    }
  ]
}
{% endschema %}