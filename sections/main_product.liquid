<script src="{{ 'pdp.js' | asset_url }}" defer></script>

{% liquid
	assign media_sizes = '(min-width: 768px) 50vw, 100vw'
%}

<div
	id="mainPDP"
	data-product-update="{{ section.id }}"
	class="w-full flex flex-col md:grid md:grid-cols-2 gap-y-margin {{ section.settings.section_margin }}"
>
  <div class="w-full flex flex-col gap-gutter" data-dynamic-content>
		{% if product.selected_or_first_available_variant.image != blank %}
			<div class="md:col-span-2">
				{% render 'image' with
					src: product.selected_or_first_available_variant.image,
					loading: 'eager',
					sizes: media_sizes,
					ratio: 1,
					class: 'w-full',
					fetchpriority: 'high'
				%}
			</div>
		{% endif %}
		<div class="hidden md:grid md:grid-cols-2 gap-gutter">
			{%- for image in product.images -%}
				{% render 'image' with
					src: image,
					sizes: media_sizes,
					ratio: 1,
					class: 'w-full'
				%}
			{%- endfor -%}
		</div>
  </div>

  <div class="px-margin" data-dynamic-content>
    <div class="flex flex-col gap-y-v-space-sm sticky top-sticky-top">
			<add-to-cart-form class="flex flex-col gap-y-4">
				{%- if section.blocks != blank -%}
					{%- for block in section.blocks -%}
						{%- case block.type -%}
							{%- when 'type' -%}
								<div {{ block.shopify_attributes }}>
									<p class='h6'>{{ product.type }}</p>
								</div>
							{%- when 'title' -%}
								<div {{ block.shopify_attributes }}>
									<h1>{{ product.title }}</h1>
								</div>
							{%- when 'text' -%}
								<div {{ block.shopify_attributes }}>
									<p class="{{ block.settings.text_style }}">{{ block.settings.text }}</p>
								</div>
							{%- when 'quantity_selector' -%}
								<div {{ block.shopify_attributes }}>
									{% render 'quantity_adjust' with item: product.selected_or_first_available_variant %}
								</div>
							{%- when 'price' -%}
								<div {{ block.shopify_attributes }}>
									<p class="body-large">
										{% render 'product_price' with item: product.selected_or_first_available_variant %}
									</p>
								</div>
							{%- when 'variant_picker' -%}
								<div {{ block.shopify_attributes }}>
									{% render 'product_option_form' with
										product: product,
										context: 'PDP'
									%}
								</div>
							{%- when 'buy_buttons' -%}
								<div {{ block.shopify_attributes }}>
									{% render 'add_to_cart_button' with
										class: "w-full large",
										product: product
									%}
								</div>
							{%- when 'description' -%}
								<div {{ block.shopify_attributes }}>
									<div class="rich-text body-small">
										{{ product.description }}
									</div>
								</div>
							{%- when 'custom_liquid' -%}
								<div {{ block.shopify_attributes }}>
									{{ block.custom_liquid }}
								</div>
							{%- when 'collapsible_tab' -%}
								<div {{ block.shopify_attributes }}>
									{{ block.title }}
									{{ block.text }}
								</div>
							{%- when 'rating' -%}
								<div {{ block.shopify_attributes }}>
									RATING
								</div>
							{%- when '@app' -%}
								<div {{ block.shopify_attributes }}>
									{% render block %}
								</div>
						{%- endcase -%}
					{%- endfor -%}
				{%- endif -%}
			</add-to-cart-form>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Product",
  "blocks": [
    {
			"type": "@app"
		},
    {
			"type": "text",
			"name": "Text Section",
			"settings": [
				{
					"type": "text",
					"id": "text",
					"default": "Text block",
					"label": "Text"
				},
				{
					"type": "select",
					"id": "text_style",
					"default": "body",
					"label": "Text Style",
					"options": [
						{
							"value": "body",
							"label": "Text"
						},
						{
							"value": "h5",
							"label": "Subtitle"
						},
						{
							"value": "small-caps",
							"label": "Uppercase"
						}
					]
				}
			]
		},
		{
			"type": "title",
			"name": "Title",
			"limit": 1
		},
		{
			"type": "quantity_selector",
			"name": "Quantity Selector",
			"limit": 1
		},
		{
			"type": "price",
			"name": "Price",
			"limit": 1
		},
		{
			"type": "type",
			"name": "Product Type",
			"limit": 1
		},
		{
			"type": "variant_picker",
			"name": "Variant Picker",
			"limit": 1,
			"settings": []
		},
		{
			"type": "buy_buttons",
			"name": "Buy Buttons",
			"limit": 1,
			"settings": [
				{
					"type": "checkbox",
					"id": "show_dynamic_checkout",
					"default": true,
					"label": "Show Dynamic Checkout Buttons"
				},
				{
					"type": "text",
					"id": "text",
					"label": "Text",
					"info": "ie: Shipping and returns policy"
				}
			]
		},
		{
			"type": "description",
			"name": "Description",
			"limit": 1
		},
		{
			"type": "custom_liquid",
			"name": "Custom Liquid",
			"settings": [
				{
					"type": "liquid",
					"id": "custom_liquid",
					"label": "Liquid Code",
					"info": "Use at your own risk"
				}
			]
		},
		{
			"type": "collapsible_tab",
			"name": "Collapsible Tab",
			"settings": [
				{
					"type": "text",
					"id": "heading",
					"default": "Collapsible row",
					"label": "Row Title"
				},
				{
					"type": "richtext",
					"id": "content",
					"label": "Text"
				}
			]
		},
		{
			"type": "rating",
			"name": "Rating",
			"limit": 1,
			"settings": [
				{
					"type": "paragraph",
					"content": "Paragraph text"
				}
			]
		}
  ],
  "settings": [
		{
      "type": "select",
      "id": "section_margin",
      "default": "mb-v-space",
      "label": "Section Margin",
      "info": "This can be used to adjust or remove the space below this section",
      "options": [
        {
          "label": "none",
          "value": "mb-0"
        },
        {
          "label": "Small",
          "value": "mb-12 md:mb-margin"
        },
        {
          "label": "Medium",
          "value": "mb-v-space-sm"
        },
        {
          "label": "Large",
          "value": "mb-v-space"
        }
      ]
    }
	]
}
{% endschema %}

